<script type="module">
import { ethers, utils, BigNumber } from "./node_modules/ethers/dist/ethers.esm.min.js";
  
// A Web3Provider wraps a standard Web3 provider, which is
// what Metamask injects as window.ethereum into each page
const provider = new ethers.providers.Web3Provider(window.ethereum);
await provider.send("eth_requestAccounts", []);

// The Metamask plugin also allows signing transactions to
// send ether and pay to change state within the blockchain.
// For this, you need the account signer...
const signer = provider.getSigner();

const publicAddress = await signer.getAddress();
console.log(publicAddress);

// From https://github.com/terra-money/shuttle/blob/main/TERRA_ASSET.md#erc20-contracts
const UST_CONTRACT = {
  ropsten: '0x6cA13a4ab78dd7D657226b155873A04DB929A3A4',
};
const ETH_TARGET_NETWORK = 'ropsten';

// Look for transfers to the target address
// Since it's bridged, this is minted.
const filter = {
    address: UST_CONTRACT[ETH_TARGET_NETWORK],
    topics: [
        utils.id("Transfer(address,address,uint256)"),
        utils.hexZeroPad('0x0', 32),
        utils.hexZeroPad(publicAddress, 32)
    ]
}
provider.once(filter, (log, event) => {
    const {data} = log;
    const amountMinted = utils.formatEther(data);
    console.log(amountMinted);
});

</script>