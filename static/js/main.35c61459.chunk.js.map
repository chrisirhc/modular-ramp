{"version":3,"sources":["operations/ethereum.ts","shuttle-abi.ts","constants.ts","erc20.ts","EthWalletConnector.tsx","utils.ts","operations/terra.ts","TerraWalletConnector.tsx","WalletConnector.tsx","operations/1inch.ts","ConversionStep.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["UST_CONTRACT","testnet","mainnet","decodeTerraAddressOnEtherBase","address","words","bech32","decode","data","fromWords","Buffer","from","toString","error","EthToTerra","ustAmount","a","ethereumContext","terraContext","toAddress","type","shuttleBurnArgs","Run","estTx","onProgress","signer","Error","sendTransaction","txArg","ret","shuttleBurn","networkType","shuttleContract","ethers","Contract","SHUTTLE_ABI","decoded","sendAmount","utils","parseUnits","tx","burn","padEnd","hash","success","waitForShuttle","provider","publicAddress","Promise","resolve","filter","topics","id","hexZeroPad","once","log","_","amountMinted","formatEther","ABI","BlockChain","terra","ethereum","bsc","BLOCKCHAIN_OPTIONS","NETWORK_TYPES","NETWORK_TYPE_OPTIONS","DEFAULT_NETWORK_TYPE","TERRA_NETWORK_CHAIN_IDS","TERRA_NETWORKS","mantle","shuttle","fcd","lcd","ERC20_ABI","EthereumContext","createContext","USTBalance","refreshBalance","CONNECTED_KEY","EthWalletConnector","bal","onChange","useState","setPublicAddress","setUSTBalance","providerAndSigner","setProviderAndSigner","shouldRefreshBalance","setShouldRefreshBalance","useEffect","sessionStorage","getItem","connect","canceled","erc20","balanceOf","balance","decimals","symbol","console","onClick","disabled","Boolean","ps","formatUnits","providers","Web3Provider","window","getSigner","send","getAddress","setItem","TERRA_DECIMAL","MIN_FEE","Coin","Int","TerraToEth","uusdDec","amountToConvert","Dec","mul","toInt","msg","MsgSend","Coins","gasPriceInUusd","estTxOptions","msgs","memo","gasPrices","uusd","getLCDClient","create","estimateFee","estimatedFee","gas","calculateTax","taxAmount","gasFeeForGasLimit","ceil","estFee","add","relayingFeeBeforMin","relayingFee","amount","lessThan","fullFee","StdFee","network","estFees","extension","post","fee","payload","sleep","waitMs","setTimeout","WaitForBalanceChange","balanceHasChanged","debug","URL","chainID","LCDClient","TerraContext","TerraWalletConnector","setExtension","wallet","setWallet","setBalance","connectInfo","setConnectInfo","bank","newBalance","toJSON","coin","uusdBal","get","div","replace","Extension","on","w","info","newPromise","prevResolve","WalletConnector","children","setNetworkType","setTerraContext","setEthereumContext","p","shadow","borderWidth","borderRadius","m","mb","value","e","target","borderColor","undefined","bg","map","justify","Provider","USDC_CONTRACT","estimate","amountString","inputCurrency","outputCurrency","fromTokenAddress","parseEther","fromAddress","url","fetch","then","r","json","fromToken","fromTokenAmount","toToken","toTokenAmount","gasPrice","valueStr","parseInt","args","Currency","currency","AllSteps","steps","setSteps","statuses","setStatuses","divider","spacing","step","i","StepForm","output","slice","onAddStep","Step","stepNumber","input","onRemoveStep","status","TransactionSummary","onStatusesChange","setNetwork","setCurrency","setAmount","placeholder","event","blockChainOption","pr","min","pointerEvents","color","fontSize","width","mt","stepName","setStepName","size","useContext","executionSteps","setExecutionSteps","useColorModeValue","align","allowToggle","flex","textAlign","as","JSON","stringify","execute","length","estimateStep","push","OneInchEstimate","currStep","TerraRun","EthWaitForShuttle","EthereumRun","App","useColorMode","colorMode","toggleColorMode","className","pt","px","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","initialColorMode","document","getElementById"],"mappings":"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","file":"static/js/main.35c61459.chunk.js","sourcesContent":["import { ethers, utils } from \"ethers\";\nimport { bech32 } from \"bech32\";\nimport SHUTTLE_ABI from \"../shuttle-abi\";\nimport { EthereumContextProps } from \"../EthWalletConnector\";\nimport { TerraContextProps } from \"../TerraWalletConnector\";\nimport { NetworkType } from \"../constants\";\n\n// From https://github.com/terra-money/shuttle/blob/main/TERRA_ASSET.md#erc20-contracts\nexport const UST_CONTRACT: Record<NetworkType, string> = {\n  testnet: \"0x6cA13a4ab78dd7D657226b155873A04DB929A3A4\",\n  mainnet: \"0xa47c8bf37f92aBed4A126BDA807A7b7498661acD\",\n} as const;\n\nconst UST_ERC20_DECIMALS = 18;\n\ntype ShuttleBurnTx = {\n  type: \"shuttleBurn\";\n  shuttleBurnArgs: {\n    toAddress: string | null | undefined;\n    ustAmount: string | undefined;\n  };\n};\n\ntype Tx = {\n  type: \"tx\";\n  txArg: ethers.providers.TransactionRequest;\n};\n\nexport type PrepTx = ShuttleBurnTx | Tx;\n\ntype WalletContexts = {\n  ethereumContext: EthereumContextProps;\n  terraContext: TerraContextProps;\n};\n\n/* bech32 */\nexport const decodeTerraAddressOnEtherBase = (address: string): string => {\n  try {\n    const { words } = bech32.decode(address);\n    const data = bech32.fromWords(words);\n    return \"0x\" + Buffer.from(data).toString(\"hex\");\n  } catch (error) {\n    return \"\";\n  }\n};\n\nexport async function EthToTerra(\n  ustAmount: string,\n  {\n    ethereumContext,\n    terraContext,\n  }: { ethereumContext: EthereumContextProps; terraContext: TerraContextProps }\n): Promise<PrepTx> {\n  // TODO: Fee estimation on Ethereum is a mystery\n  const toAddress = terraContext.address;\n\n  return {\n    type: \"shuttleBurn\",\n    shuttleBurnArgs: {\n      toAddress,\n      ustAmount,\n    },\n  };\n}\n\nexport type RunArg = PrepTx;\n\nexport async function Run(\n  estTx: PrepTx,\n  {\n    onProgress = () => {},\n    ethereumContext,\n  }: {\n    onProgress?: (status: string) => void;\n    ethereumContext: EthereumContextProps;\n  }\n) {\n  switch (estTx.type) {\n    case \"tx\":\n      if (!ethereumContext.signer) {\n        throw new Error(\"Missing signer\");\n      }\n      onProgress(\"Initiating transaction...\");\n      try {\n        const ret = await ethereumContext.signer.sendTransaction(estTx.txArg);\n        onProgress(\"Transaction successful\");\n        return ret;\n      } catch (e) {\n        onProgress(`Transaction failed ${e}`);\n        throw e;\n      }\n    case \"shuttleBurn\":\n      if (!estTx.shuttleBurnArgs) {\n        throw new Error(\"Missing args\");\n      }\n      return shuttleBurn(estTx.shuttleBurnArgs, {\n        ethereumContext,\n        onProgress,\n      });\n    default:\n      const _exhaustiveCheck: never = estTx;\n      throw new Error(`Unreachable code reached due to ${_exhaustiveCheck}`);\n  }\n}\n\nasync function shuttleBurn(\n  {\n    toAddress,\n    ustAmount,\n  }: {\n    toAddress: string | null | undefined;\n    ustAmount: string | undefined;\n  },\n  {\n    onProgress = () => {},\n    ethereumContext,\n  }: {\n    onProgress?: (status: string) => void;\n    ethereumContext: EthereumContextProps;\n  }\n) {\n  const { signer, networkType } = ethereumContext;\n\n  if (!toAddress || !ustAmount || !networkType) {\n    return;\n  }\n\n  if (!signer) {\n    return;\n  }\n\n  const shuttleContract = new ethers.Contract(\n    UST_CONTRACT[networkType],\n    SHUTTLE_ABI,\n    signer\n  );\n  const decoded = decodeTerraAddressOnEtherBase(toAddress);\n  const sendAmount = utils.parseUnits(ustAmount, UST_ERC20_DECIMALS);\n  try {\n    const tx = shuttleContract.burn(sendAmount, decoded.padEnd(66, \"0\"));\n    onProgress(\"Initiating transaction...\");\n    const { hash } = await tx;\n    onProgress(\"Transaction successful.\");\n    return { success: true, hash };\n  } catch (error) {\n    throw error;\n    // return handleTxErrorFromEtherBase(error)\n  }\n}\n\nexport async function waitForShuttle({ ethereumContext }: WalletContexts) {\n  const { provider, publicAddress, networkType } = ethereumContext;\n  if (!publicAddress) {\n    throw new Error(\"No public address of ethereum wallet\");\n  }\n  if (!provider) {\n    throw new Error(\"No provider\");\n  }\n  if (!networkType) {\n    throw new Error(\"No network type selected\");\n  }\n\n  return new Promise((resolve) => {\n    // Look for transfers to the target address\n    // Since it's bridged, this is minted (i.e. fromAddress=0x0).\n    const filter = {\n      address: UST_CONTRACT[networkType],\n      topics: [\n        utils.id(\"Transfer(address,address,uint256)\"),\n        utils.hexZeroPad(\"0x0\", 32 /* length of these fields */),\n        utils.hexZeroPad(publicAddress, 32),\n      ],\n    };\n    provider.once(filter, (log, _) => {\n      const { data } = log;\n      const amountMinted = utils.formatEther(data);\n      resolve(amountMinted);\n    });\n  });\n}\n","// https://github.com/terra-money/bridge-web-app/blob/060979b7966d66368d54819a7c83f68949e71014/src/consts/abi.json\nconst ABI = [\n  \"function balanceOf(address owner) view returns (uint256)\",\n  \"function decimals() view returns (uint8)\",\n  \"function symbol() view returns (string)\",\n\n  \"function earned(address account) public view returns (uint256)\",\n  \"function allowance(address owner, address spender) external view returns (uint256)\",\n\n  \"function totalSupply() public view returns (uint256)\",\n  \"function currentReward() public view returns (uint256)\",\n  \"function lastTimeRewardApplicable() public view returns (uint256)\",\n  \"function rewardPerToken() public view returns (uint256)\",\n\n  \"function transfer(address to, uint amount) returns (boolean)\",\n  \"function burn(uint256 amount, bytes32 to) returns (boolean)\",\n  \"function approve(address spender, uint256 amount) external returns (bool)\",\n  \"function stake(uint256 amount) external\",\n  \"function withdraw(uint256 amount) external\",\n  \"function getReward() external\",\n  \"function claim(uint256 index, address account, uint256 amount, bytes32[] calldata merkleProof) external\",\n\n  \"event Transfer(address indexed from, address indexed to, uint amount)\",\n];\n\nexport default ABI;\n","export const BlockChain = {\n  terra: \"Terra\",\n  ethereum: \"Ethereum\",\n  bsc: \"Binance Smart Chain\",\n} as const;\n\nexport type BlockChainType = keyof typeof BlockChain;\nexport const BLOCKCHAIN_OPTIONS: BlockChainType[] = [\"ethereum\", \"terra\"];\n\nexport const NETWORK_TYPES = {\n  testnet: \"Testnet: Ropsten / Tequila\",\n  mainnet: \"Main Net\",\n} as const;\n\nexport type NetworkType = keyof typeof NETWORK_TYPES;\n\nexport const NETWORK_TYPE_OPTIONS: NetworkType[] = [\"testnet\", \"mainnet\"];\n\nexport const DEFAULT_NETWORK_TYPE: keyof typeof NETWORK_TYPES = \"testnet\";\n\n// From Terra Bridge app\nexport type ShuttleNetwork = \"bsc\" | \"ethereum\";\n\nexport interface LocalTerraNetwork {\n  /** Graphql server URL */\n  mantle: string;\n  /** Ethereum */\n  shuttle: Record<ShuttleNetwork, string>;\n  lcd: string;\n  fcd: string;\n}\n\nexport const TERRA_NETWORK_CHAIN_IDS: Record<NetworkType, string> = {\n  mainnet: \"columbus-4\",\n  testnet: \"tequila-0004\",\n};\n\nexport const TERRA_NETWORKS: Record<NetworkType, LocalTerraNetwork> = {\n  mainnet: {\n    mantle: \"https://mantle.terra.dev/\",\n    // Validate via https://github.com/terra-money/shuttle/blob/main/TERRA_ASSET.md#usage-instructions\n    shuttle: {\n      ethereum: \"terra13yxhrk08qvdf5zdc9ss5mwsg5sf7zva9xrgwgc\",\n      bsc: \"terra1g6llg3zed35nd3mh9zx6n64tfw3z67w2c48tn2\",\n    },\n    fcd: \"https://fcd.terra.dev\",\n    lcd: \"https://lcd.terra.dev\",\n  },\n  testnet: {\n    mantle: \"https://tequila-mantle.terra.dev/\",\n    shuttle: {\n      ethereum: \"terra10a29fyas9768pw8mewdrar3kzr07jz8f3n73t3\",\n      bsc: \"terra1paav7jul3dzwzv78j0k59glmevttnkfgmgzv2r\",\n    },\n    fcd: \"https://tequila-fcd.terra.dev\",\n    lcd: \"https://tequila-lcd.terra.dev\",\n  },\n};\n","// A Human-Readable ABI; any supported ABI format could be used\nexport const ERC20_ABI = [\n  // Read-Only Functions\n  \"function balanceOf(address owner) view returns (uint256)\",\n  \"function decimals() view returns (uint8)\",\n  \"function symbol() view returns (string)\",\n\n  // Authenticated Functions\n  \"function transfer(address to, uint amount) returns (boolean)\",\n\n  // Events\n  \"event Transfer(address indexed from, address indexed to, uint amount)\",\n];\n\n// // This can be an address or an ENS name\n// const address = \"dai.tokens.ethers.eth\";\n\n// // An example Provider\n// const provider = ethers.getDefaultProvider();\n\n// // An example Signer\n// const signer = ethers.Wallet.createRandom().connect(provider);\n\n// // Read-Only; By connecting to a Provider, allows:\n// // - Any constant function\n// // - Querying Filters\n// // - Populating Unsigned Transactions for non-constant methods\n// // - Estimating Gas for non-constant (as an anonymous sender)\n// // - Static Calling non-constant methods (as anonymous sender)\n// const erc20 = new ethers.Contract(address, abi, provider);\n\n// // Read-Write; By connecting to a Signer, allows:\n// // - Everything from Read-Only (except as Signer, not anonymous)\n// // - Sending transactions for non-constant functions\n// const erc20_rw = new ethers.Contract(address, abi, signer)\n","import React, { createContext, useEffect, useState } from \"react\";\nimport { Box, Button } from \"@chakra-ui/react\";\nimport { ethers, utils, BigNumber } from \"ethers\";\n\nimport { NetworkType } from \"./constants\";\nimport { ERC20_ABI } from \"./erc20\";\n\n// Assume this is injected by Metamask\ndeclare global {\n  interface Window {\n    ethereum: any;\n  }\n}\n\n// From https://github.com/terra-money/shuttle/blob/main/TERRA_ASSET.md#erc20-contracts\nconst UST_CONTRACT: Record<NetworkType, string> = {\n  testnet: \"0x6cA13a4ab78dd7D657226b155873A04DB929A3A4\",\n  mainnet: \"0xa47c8bf37f92aBed4A126BDA807A7b7498661acD\",\n};\n\nexport type EthereumContextProps = {\n  USTBalance: Balance | null;\n  publicAddress: string | null;\n  provider: ethers.providers.Web3Provider | null;\n  signer: ethers.providers.JsonRpcSigner | null;\n  refreshBalance: () => void;\n  networkType: NetworkType | null;\n};\n\nexport const EthereumContext = createContext<EthereumContextProps>({\n  USTBalance: null,\n  publicAddress: null,\n  provider: null,\n  signer: null,\n  refreshBalance: () => {},\n  networkType: null,\n});\n\ntype Props = {\n  networkType: NetworkType;\n  onChange: (e: EthereumContextProps) => void;\n};\n\ntype Balance = {\n  balance: BigNumber;\n  decimals: any;\n  symbol: string;\n};\n\nfunction printBalance(bal: Balance | null) {\n  return (bal && utils.formatUnits(bal.balance, bal.decimals)) || \"\";\n}\n\nconst CONNECTED_KEY = \"eth_connected\";\n\nexport function EthWalletConnector({ networkType, onChange }: Props) {\n  const [publicAddress, setPublicAddress] = useState<string | null>(null);\n  const [USTBalance, setUSTBalance] = useState<Balance | null>(null);\n  const [providerAndSigner, setProviderAndSigner] = useState<{\n    provider: ethers.providers.Web3Provider | null;\n    signer: ethers.providers.JsonRpcSigner | null;\n  } | null>(null);\n  const [shouldRefreshBalance, setShouldRefreshBalance] =\n    useState<boolean>(true);\n\n  useEffect(() => {\n    if (sessionStorage.getItem(CONNECTED_KEY) === CONNECTED_KEY) {\n      connect();\n    }\n  }, []);\n\n  useEffect(() => {\n    let canceled = false;\n\n    (async () => {\n      if (\n        !providerAndSigner ||\n        !providerAndSigner?.provider ||\n        !publicAddress ||\n        !shouldRefreshBalance\n      ) {\n        return;\n      }\n\n      const { provider } = providerAndSigner;\n      try {\n        const erc20 = new ethers.Contract(\n          UST_CONTRACT[networkType],\n          ERC20_ABI,\n          provider\n        );\n        const balance: BigNumber = await erc20.balanceOf(publicAddress);\n        const decimals = await erc20.decimals();\n        const symbol = await erc20.symbol();\n        if (canceled) {\n          return;\n        }\n        setUSTBalance({ balance, decimals, symbol });\n        setShouldRefreshBalance(false);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n\n    return () => {\n      canceled = true;\n    };\n  }, [providerAndSigner, publicAddress, shouldRefreshBalance, networkType]);\n\n  useEffect(() => {\n    onChange({\n      USTBalance,\n      publicAddress,\n      provider: providerAndSigner?.provider || null,\n      signer: providerAndSigner?.signer || null,\n      refreshBalance,\n      networkType,\n    });\n  }, [onChange, USTBalance, publicAddress, providerAndSigner, networkType]);\n\n  return (\n    <Box>\n      <Button onClick={connect} disabled={Boolean(publicAddress)}>\n        {publicAddress ? `Connected` : \"Connect\"} to Ethereum\n      </Button>\n      <Box ps={2}>\n        <small>\n          {publicAddress}\n          {USTBalance ? (\n            <div>\n              <pre>{printBalance(USTBalance)} UST</pre>\n            </div>\n          ) : null}\n        </small>\n      </Box>\n    </Box>\n  );\n\n  async function connect() {\n    // Only works with Metamask right now.\n    const provider = new ethers.providers.Web3Provider(window.ethereum);\n    const signer = provider.getSigner();\n    setProviderAndSigner({\n      provider,\n      signer,\n    });\n\n    await provider.send(\"eth_requestAccounts\", []);\n    const publicAddress = await signer.getAddress();\n    setPublicAddress(publicAddress);\n\n    sessionStorage.setItem(CONNECTED_KEY, CONNECTED_KEY);\n  }\n\n  function refreshBalance() {\n    setShouldRefreshBalance(true);\n  }\n}\n","import { Coin, Dec } from \"@terra-money/terra.js\";\n\nexport const TERRA_DECIMAL = 1e6;\n\nexport function printTerraAmount(coin: Coin | null | undefined) {\n  if (!coin) {\n    return \"\";\n  }\n  return (\n    new Dec(coin.amount)\n      .div(TERRA_DECIMAL)\n      .toString()\n      // Remove trailing space\n      .replace(/\\.?0+$/, \"\")\n  );\n}\n","import {\n  Coin,\n  Coins,\n  Dec,\n  MsgSend,\n  StdFee,\n  CreateTxOptions,\n  Int,\n  LCDClient,\n} from \"@terra-money/terra.js\";\nimport { TERRA_DECIMAL } from \"../utils\";\nimport { RefreshBalanceRet, TerraContextProps } from \"../TerraWalletConnector\";\nimport { WalletContexts } from \"../types\";\nimport {\n  NetworkType,\n  TERRA_NETWORKS,\n  TERRA_NETWORK_CHAIN_IDS,\n} from \"../constants\";\n\nconst MIN_FEE = new Coin(\"uusd\", new Int(1 * TERRA_DECIMAL));\n\nexport interface EstTx {\n  network: \"terra\";\n  amount: Coin;\n  estTx: CreateTxOptions;\n  estFees: StdFee;\n  relayingFee: Coin;\n}\n\nexport async function TerraToEth(\n  uusdDec: string,\n  { ethereumContext, terraContext }: WalletContexts\n): Promise<EstTx> {\n  const { address, networkType } = terraContext;\n  if (!networkType) {\n    throw new Error(\"No network type selected.\");\n  }\n  if (!address) {\n    throw new Error(\"No address found.\");\n  }\n  if (!ethereumContext.publicAddress) {\n    throw new Error(\"No Ethereum address found.\");\n  }\n\n  const amountToConvert = new Coin(\n    \"uusd\",\n    new Dec(uusdDec).mul(TERRA_DECIMAL).toInt()\n  );\n\n  // https://docs.terra.money/dev/#currency-denominations\n  const msg = new MsgSend(\n    address,\n    TERRA_NETWORKS[networkType].shuttle.ethereum,\n    new Coins([amountToConvert])\n  );\n\n  const gasPriceInUusd = 0.15; // in uusd. TODO: This can change and should be retrieved from lcd.\n  const estTxOptions: CreateTxOptions = {\n    msgs: [msg],\n    memo: ethereumContext.publicAddress,\n    gasPrices: new Coins({ uusd: gasPriceInUusd }),\n  };\n  // Fee calculation is a PITA\n  // See https://github.com/terra-money/bridge-web-app/blob/060979b7966d66368d54819a7c83f68949e71014/src/hooks/useSend.ts#L139-L197\n  const terra = getLCDClient(terraContext);\n  const estTx = await terra.tx.create(address, estTxOptions);\n  const estimatedFee = await terra.tx.estimateFee(estTx);\n  console.log(\"estimated gas needed\", estimatedFee.gas);\n\n  // Fee calculation is a PITA. Assume everything here is being calculated in uusd\n  const taxAmount = await terra.utils.calculateTax(amountToConvert);\n  // From https://tequila-fcd.terra.dev/v1/txs/gas_prices\n  const gasFeeForGasLimit = new Int(estimatedFee.gas)\n    .mul(gasPriceInUusd)\n    .ceil(); // in uusd\n\n  const estFee = taxAmount.add(gasFeeForGasLimit);\n  const relayingFeeBeforMin = amountToConvert.mul(0.1 * 0.01); // 0.1%\n  const relayingFee = relayingFeeBeforMin.amount.lessThan(MIN_FEE.amount)\n    ? MIN_FEE\n    : relayingFeeBeforMin; // Or $1\n  // Need to apply min fee\n  const fullFee = new StdFee(estimatedFee.gas, [estFee]);\n\n  return {\n    network: \"terra\",\n    amount: amountToConvert,\n    estTx: estTxOptions,\n    estFees: fullFee,\n    relayingFee,\n  };\n}\n\nexport type RunArg = EstTx;\n\nexport async function Run(\n  estTx: EstTx,\n  {\n    onProgress = () => {},\n    terraContext,\n  }: {\n    onProgress?: (status: string) => void;\n    terraContext: TerraContextProps;\n  }\n) {\n  const { extension } = terraContext;\n  if (!estTx || !extension) {\n    return;\n  }\n\n  return new Promise((resolve) => {\n    extension.post({\n      ...estTx.estTx,\n      fee: estTx.estFees,\n    });\n    extension.once(\"onPost\", (payload) => {\n      console.log(payload);\n      resolve(payload);\n      onProgress(`Transaction ID: ${payload.id}, Success: ${payload.success}`);\n    });\n    onProgress(\"Posting transaction...\");\n  });\n}\n\nasync function sleep(waitMs: number) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, waitMs);\n  });\n}\n\nexport async function WaitForBalanceChange({ terraContext }: WalletContexts) {\n  let ret: RefreshBalanceRet | void;\n  while (!ret?.balanceHasChanged) {\n    // TODO: Exponential backoff?\n    console.debug(\"Waiting, no change\");\n    await sleep(5000);\n    ret = await terraContext.refreshBalance();\n  }\n  console.debug(\"Done waiting\");\n  return;\n}\n\nexport function getLCDClient({\n  networkType,\n}: {\n  networkType: NetworkType | null;\n}) {\n  if (!networkType) {\n    throw new Error(\"No network type selected.\");\n  }\n  const URL = TERRA_NETWORKS[networkType].lcd;\n  const chainID = TERRA_NETWORK_CHAIN_IDS[networkType];\n  return new LCDClient({\n    URL,\n    chainID,\n  });\n}\n","import React, { createContext, useEffect, useState } from \"react\";\nimport { Box, Button } from \"@chakra-ui/react\";\n\nimport { Extension, Coins } from \"@terra-money/terra.js\";\nimport { printTerraAmount } from \"./utils\";\nimport { NetworkType, TERRA_NETWORKS } from \"./constants\";\nimport { getLCDClient } from \"./operations/terra\";\n\n// Return true if the balance has changed\nexport type RefreshBalanceRet = {\n  balanceHasChanged: boolean;\n};\nexport type RefreshBalanceFn =\n  | (() => Promise<RefreshBalanceRet>)\n  | (() => void);\n\nexport type TerraContextProps = {\n  extension: Extension | null;\n  address: string | null;\n  balance: Coins | null;\n  refreshBalance: RefreshBalanceFn;\n  networkType: NetworkType | null;\n};\n\nexport interface InfoResponse {\n  chainID: string;\n  fcd: string;\n  lcd: string;\n  name: string;\n}\n\nexport const TerraContext = createContext<TerraContextProps>({\n  extension: null,\n  address: null,\n  balance: null,\n  refreshBalance: () => {},\n  networkType: null,\n});\n\ntype Props = {\n  networkType: NetworkType;\n  onChange: (t: TerraContextProps) => void;\n};\n\nconst CONNECTED_KEY = \"terra_connected\";\n\ntype ShouldRefreshBalanceType = {\n  resolve: (ret: RefreshBalanceRet | Promise<RefreshBalanceRet>) => void;\n};\n\nexport function TerraWalletConnector({ networkType, onChange }: Props) {\n  const [extension, setExtension] = useState<Extension | null>(null);\n  const [wallet, setWallet] = useState<string | null>(null);\n  const [balance, setBalance] = useState<Coins | null>(null);\n  const [connectInfo, setConnectInfo] = useState<InfoResponse | null>(null);\n  const [shouldRefreshBalance, setShouldRefreshBalance] =\n    useState<null | ShouldRefreshBalanceType>(null);\n\n  // Helps with refreshes and development\n  useEffect(() => {\n    if (sessionStorage.getItem(CONNECTED_KEY) === CONNECTED_KEY) {\n      connect();\n    }\n  }, []);\n\n  useEffect(() => {\n    refreshBalance();\n  }, [wallet, networkType]);\n\n  // Use state to set up a refreshing state\n  useEffect(() => {\n    let canceled = false;\n    if (!shouldRefreshBalance) {\n      return;\n    }\n    if (!wallet) {\n      return;\n    }\n    (async () => {\n      const newBalance = await getLCDClient({ networkType }).bank.balance(\n        wallet\n      );\n      if (canceled) {\n        return;\n      }\n      const balanceHasChanged = balance?.toJSON() !== newBalance.toJSON();\n      if (balanceHasChanged) {\n        setBalance(newBalance);\n      }\n      shouldRefreshBalance.resolve({\n        balanceHasChanged,\n      });\n      // I had no idea where to put this line. And why if I put it anywhere above, it wouldn't work.\n      // The interaction between canceled and shouldRefreshBalance, + the setState function, totally messed me up.\n      // Please remember sending a function to setState, not expected!\n      setShouldRefreshBalance(null);\n    })();\n    return () => {\n      canceled = true;\n      // Should resolve the old balance into the new version\n      // Should this reject the old refresh call or return a new one?\n    };\n  }, [shouldRefreshBalance, wallet, balance, networkType]);\n\n  // Argument of type '() => Promise<{ balanceHasChanged: boolean; } | undefined>' is not assignable to parameter of type 'RefreshBalanceRet'.\n  // Property 'balanceHasChanged' is missing in type '() => Promise<{ balanceHasChanged: boolean; } | undefined>' but required in type 'RefreshBalanceRet'.\n\n  useEffect(() => {\n    if (connectInfo && TERRA_NETWORKS[networkType].lcd !== connectInfo.lcd) {\n      console.error(\"Network chosen does not match Terra extension network\");\n    }\n\n    onChange({\n      /* TODO: Use Memo */\n      extension,\n      address: wallet,\n      balance,\n      networkType,\n      refreshBalance,\n    });\n  }, [onChange, extension, wallet, balance, networkType, connectInfo]);\n\n  const uusdBal = balance && balance.get(\"uusd\");\n\n  return (\n    <Box>\n      <Button onClick={connect} disabled={Boolean(wallet)}>\n        {wallet ? `Connected` : \"Connect\"} to Terra\n      </Button>\n      <Box ps={2}>\n        <small>\n          {wallet}\n          {uusdBal ? (\n            <div>\n              <pre>{printTerraAmount(uusdBal)} UST</pre>\n            </div>\n          ) : null}\n        </small>\n      </Box>\n    </Box>\n  );\n\n  type ConnectResponse = {\n    address: string;\n  };\n\n  function connect() {\n    const extension = new Extension();\n    extension.connect();\n    extension.on(\"onConnect\", (w: ConnectResponse) => {\n      setWallet(w.address);\n\n      extension.info();\n      extension.on(\"onInfo\", (info: InfoResponse) => {\n        setConnectInfo(info);\n      });\n    });\n    setExtension(extension);\n    sessionStorage.setItem(CONNECTED_KEY, CONNECTED_KEY);\n  }\n\n  /**\n   * Be careful with referencing state within this function.\n   * The function is used elsewhere and needs to always get the latest\n   * values. Hence, the use of getters and useRef to store state.\n   *\n   * There might be cleaner patterns for doing this.\n   * TODO: in the future.\n   */\n  async function refreshBalance(): Promise<RefreshBalanceRet> {\n    // This seems super complex/unreadable. Are we overthinking this? Lol.\n    const newPromise: Promise<RefreshBalanceRet> = new Promise((resolve) => {\n      // Careful about calling setState with a function.\n      // React calls instead of setting it as state.\n      setShouldRefreshBalance((prevResolve) => {\n        prevResolve?.resolve(newPromise);\n        return {\n          resolve,\n        };\n      });\n    });\n    return newPromise;\n  }\n}\n","import React, { createContext, useEffect, useRef, useState } from \"react\";\nimport { Box, Button, HStack, Select, Wrap, WrapItem } from \"@chakra-ui/react\";\nimport {\n  DEFAULT_NETWORK_TYPE,\n  NetworkType,\n  NETWORK_TYPES,\n  NETWORK_TYPE_OPTIONS,\n} from \"./constants\";\nimport {\n  EthWalletConnector,\n  EthereumContext,\n  EthereumContextProps,\n} from \"./EthWalletConnector\";\nimport {\n  TerraWalletConnector,\n  TerraContext,\n  TerraContextProps,\n} from \"./TerraWalletConnector\";\n\ntype Props = {\n  children: React.ReactNode;\n};\n\nexport function WalletConnector({ children }: Props) {\n  const [networkType, setNetworkType] =\n    useState<NetworkType>(DEFAULT_NETWORK_TYPE);\n  const [terraContext, setTerraContext] = useState<TerraContextProps>({\n    extension: null,\n    address: null,\n    balance: null,\n    refreshBalance: () => {},\n    networkType: DEFAULT_NETWORK_TYPE,\n  });\n  const [ethereumContext, setEthereumContext] = useState<EthereumContextProps>({\n    USTBalance: null,\n    publicAddress: null,\n    provider: null,\n    signer: null,\n    refreshBalance: () => {},\n    networkType: DEFAULT_NETWORK_TYPE,\n  });\n\n  return (\n    <Box>\n      <Box p={4} shadow=\"md\" borderWidth=\"1px\" borderRadius=\"md\" m={5}>\n        <Box>\n          <Select\n            mb={2}\n            value={networkType}\n            onChange={(e) => setNetworkType(e.target.value as NetworkType)}\n            borderColor={networkType === \"mainnet\" ? \"red.500\" : undefined}\n            bg={networkType === \"mainnet\" ? \"red.500\" : \"transparent\"}\n          >\n            {NETWORK_TYPE_OPTIONS.map((networkType) => (\n              <option key={networkType} value={networkType}>\n                {NETWORK_TYPES[networkType]}\n              </option>\n            ))}\n          </Select>\n        </Box>\n        <Wrap justify=\"space-evenly\">\n          <WrapItem>\n            <EthWalletConnector\n              networkType={networkType}\n              onChange={setEthereumContext}\n            />\n          </WrapItem>\n          <WrapItem>\n            <TerraWalletConnector\n              networkType={networkType}\n              onChange={setTerraContext}\n            />\n          </WrapItem>\n        </Wrap>\n      </Box>\n      <Box>\n        <TerraContext.Provider value={terraContext}>\n          <EthereumContext.Provider value={ethereumContext}>\n            {children}\n          </EthereumContext.Provider>\n        </TerraContext.Provider>\n      </Box>\n    </Box>\n  );\n}\n","import { ethers, utils, BigNumber, providers } from \"ethers\";\nimport { EthereumContextProps } from \"../EthWalletConnector\";\nimport { PrepTx, UST_CONTRACT } from \"./ethereum\";\n\n// https://etherscan.io/token/0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48\nconst USDC_CONTRACT = \"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48\";\n\ntype Arg = {\n  args: PrepTx;\n  info: {};\n};\n\ninterface TokenResponse {\n  symbol: string;\n  name: string;\n  decimals: number;\n  address: string;\n}\n\ntype SwapResponse = {\n  fromToken: TokenResponse;\n  toToken: TokenResponse;\n  fromTokenAmount: string;\n  toTokenAmount: string;\n  tx: any;\n};\n\nexport async function estimate(\n  {\n    amountString,\n    inputCurrency,\n    outputCurrency,\n  }: { amountString: string; inputCurrency: string; outputCurrency: string },\n  { ethereumContext }: { ethereumContext: EthereumContextProps }\n): Promise<Arg> {\n  const { publicAddress } = ethereumContext;\n\n  if (!(inputCurrency === \"UST\" && outputCurrency === \"USDC\")) {\n    throw new Error(\n      `Unsupported currencies, only UST to USDC is supported. You requested ${inputCurrency} -> ${outputCurrency}`\n    );\n  }\n\n  const fromTokenAddress = UST_CONTRACT.mainnet;\n  const toTokenAddress = USDC_CONTRACT;\n  const amount = utils.parseEther(amountString);\n  // TODO: Add referrerAddress is pretty cool, incentivizes the right behaviors, along with fee\n  // const url = `https://api.1inch.exchange/v3.0/1/quote?fromTokenAddress=${fromTokenAddress}&toTokenAddress=${toTokenAddress}&amount=${amount}`;\n\n  const fromAddress = publicAddress;\n  const slippage = 0.5;\n  // TODO: Check back later\n  const disableEstimate = true; // remove later\n  const url = `https://api.1inch.exchange/v3.0/1/swap?fromTokenAddress=${fromTokenAddress}&toTokenAddress=${toTokenAddress}&amount=${amount}&fromAddress=${fromAddress}&slippage=${slippage}${\n    disableEstimate ? \"&disableEstimate=true\" : \"\"\n  }`;\n  return fetch(url)\n    .then((r) => r.json())\n    .then((data: SwapResponse) => {\n      console.log(data);\n\n      /* Not yet tested */\n      const { tx, fromToken, fromTokenAmount, toToken, toTokenAmount } = data;\n      // Ethers will fill these\n      delete tx.gas;\n      delete tx.gasPrice;\n\n      // Make value into hex per https://docs.1inch.io/api/nodejs-web3-example\n      const valueInt = parseInt(tx[\"value\"]); //get the value from the transaction\n      const valueStr = \"0x\" + valueInt.toString(16); //add a leading 0x after converting from decimal to hexadecimal\n      tx[\"value\"] = valueStr;\n      return {\n        info: {\n          fromToken,\n          fromTokenAmount,\n          toToken,\n          toTokenAmount,\n        },\n        args: {\n          type: \"tx\",\n          txArg: tx,\n        },\n      };\n    });\n}\n","import React, {\n  createContext,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport {\n  Button,\n  FormControl,\n  FormLabel,\n  FormErrorMessage,\n  FormHelperText,\n  Select,\n  Input,\n  InputGroup,\n  InputRightElement,\n  VStack,\n  StackDivider,\n  Box,\n  HStack,\n  Heading,\n  Code,\n  Accordion,\n  AccordionItem,\n  AccordionButton,\n  AccordionPanel,\n  Spinner,\n  useColorModeValue,\n} from \"@chakra-ui/react\";\n\nimport { EthereumContext, EthereumContextProps } from \"./EthWalletConnector\";\nimport { TerraContext, TerraContextProps } from \"./TerraWalletConnector\";\nimport {\n  TerraToEth,\n  Run as TerraRun,\n  RunArg as TerraRunArg,\n  WaitForBalanceChange,\n} from \"./operations/terra\";\nimport {\n  EthToTerra,\n  Run as EthereumRun,\n  RunArg as EthereumRunArg,\n  waitForShuttle as EthWaitForShuttle,\n} from \"./operations/ethereum\";\nimport { estimate as OneInchEstimate } from \"./operations/1inch\";\nimport { BlockChain, BlockChainType, BLOCKCHAIN_OPTIONS } from \"./constants\";\nimport { WalletContexts } from \"./types\";\n\nclass Currency {\n  network: BlockChainType | null = null;\n  currency: \"UST\" | \"USDC\" | string | null = null;\n  amount?: string | null = null; // Might need to check on a standard amount\n  // there's some fees involved\n}\n\ninterface StepFormProps {\n  input?: Currency;\n  output: Currency;\n  onChange: (output: Currency) => void;\n  onAddStep: () => void;\n  onRemoveStep?: () => void;\n  // output, fees\n}\n\ntype Status = string | null;\n\ninterface ConversionStepProps extends StepFormProps {\n  input: Currency;\n  stepNumber: number;\n  status: Status;\n  onRemoveStep: () => void;\n  // output, fees\n}\n\nexport function AllSteps() {\n  const [steps, setSteps] = useState<Currency[]>([new Currency()]);\n  const [statuses, setStatuses] = useState<Status[]>([]);\n  return (\n    <Box p={4} shadow=\"md\" borderWidth=\"1px\" borderRadius=\"md\" m={5}>\n      <VStack divider={<StackDivider borderColor=\"gray.200\" />} spacing={4}>\n        {steps.map((step, i) =>\n          i === 0 ? (\n            <Box key={0}>\n              <StepForm\n                output={step}\n                onChange={(output) => setSteps([output, ...steps.slice(1)])}\n                onAddStep={() =>\n                  setSteps([\n                    ...steps.slice(0, i + 1),\n                    new Currency(),\n                    ...steps.slice(i + 1),\n                  ])\n                }\n              />\n            </Box>\n          ) : (\n            <Step\n              stepNumber={i - 1}\n              key={i}\n              input={steps[i - 1]}\n              output={step}\n              onChange={(output) =>\n                setSteps([...steps.slice(0, i), output, ...steps.slice(i + 1)])\n              }\n              onAddStep={() =>\n                setSteps([\n                  ...steps.slice(0, i),\n                  new Currency(),\n                  ...steps.slice(i),\n                ])\n              }\n              onRemoveStep={() =>\n                setSteps([...steps.slice(0, i), ...steps.slice(i + 1)])\n              }\n              status={statuses[i - 1]}\n            />\n          )\n        )}\n        <TransactionSummary steps={steps} onStatusesChange={setStatuses} />\n      </VStack>\n    </Box>\n  );\n}\n\nexport function StepForm({\n  input,\n  output,\n  onChange,\n  onAddStep,\n  onRemoveStep,\n}: StepFormProps) {\n  const setNetwork = (network: BlockChainType) => {\n    onChange({\n      ...output,\n      network,\n    });\n  };\n\n  const setCurrency = (currency: string) => {\n    onChange({\n      ...output,\n      currency,\n    });\n  };\n\n  const setAmount = (amount: string) => {\n    onChange({\n      ...output,\n      amount,\n    });\n  };\n\n  // No constraints, pick whatever you want and handle the estimates\n  return (\n    <>\n      <HStack>\n        <FormControl>\n          <FormLabel>Network</FormLabel>\n          <Select\n            placeholder=\"Select network\"\n            value={output.network || \"\"}\n            onChange={(event) =>\n              setNetwork(event.target.value as BlockChainType)\n            }\n          >\n            {BLOCKCHAIN_OPTIONS.map((blockChainOption) => (\n              <option key={blockChainOption} value={blockChainOption}>\n                {BlockChain[blockChainOption]}\n              </option>\n            ))}\n          </Select>\n        </FormControl>\n        {input?.network !== \"terra\" ? (\n          <FormControl>\n            <FormLabel>Currency</FormLabel>\n            <Select\n              placeholder=\"Select currency\"\n              onChange={(event) => setCurrency(event.target.value)}\n            >\n              <option>UST</option>\n              <option>USDC</option>\n            </Select>\n          </FormControl>\n        ) : null}\n      </HStack>\n      <FormControl>\n        <FormLabel>Amount</FormLabel>\n        <InputGroup>\n          <Input\n            placeholder=\"Enter amount\"\n            type=\"number\"\n            pr=\"4.5rem\"\n            min=\"0\"\n            value={output.amount || \"\"}\n            onChange={(event) => setAmount(event.target.value)}\n          />\n          <InputRightElement\n            pointerEvents=\"none\"\n            color=\"gray.300\"\n            fontSize=\"1.2em\"\n            width=\"4.5rem\"\n            children={output.currency}\n          />\n        </InputGroup>\n      </FormControl>\n      <HStack mt={5}>\n        <Button onClick={onAddStep}>Add Step</Button>\n        {onRemoveStep ? (\n          <Button onClick={onRemoveStep}>Remove Step</Button>\n        ) : null}\n      </HStack>\n    </>\n  );\n}\n\nexport function Step({\n  stepNumber,\n  input,\n  output,\n  onChange,\n  onAddStep,\n  onRemoveStep,\n  status,\n}: ConversionStepProps) {\n  const [stepName, setStepName] = useState(\"\");\n\n  useEffect(() => {\n    if (!input.network || !output.network) {\n      return;\n    }\n    switch (true) {\n      case input.network !== output.network:\n        setStepName(\n          `Bridge ${BlockChain[input.network]} to ${BlockChain[output.network]}`\n        );\n        break;\n      default:\n        setStepName(`Step  ${stepNumber + 1}`);\n    }\n  }, [input, output, stepNumber]);\n\n  return (\n    <Box>\n      <Heading size=\"md\">{stepName}</Heading>\n      <StepForm\n        input={input}\n        output={output}\n        onAddStep={onAddStep}\n        onRemoveStep={onRemoveStep}\n        onChange={onChange}\n      />\n      {status ? (\n        <>\n          <Spinner />\n          {status}\n        </>\n      ) : null}\n    </Box>\n  );\n}\n\ntype TransactionSummaryProps = {\n  steps: Currency[];\n  onStatusesChange: (statuses: Status[]) => void;\n};\n\nexport function TransactionSummary({\n  steps,\n  onStatusesChange,\n}: TransactionSummaryProps) {\n  const terraContext = useContext(TerraContext);\n  const ethereumContext = useContext(EthereumContext);\n  const [executionSteps, setExecutionSteps] = useState<ExecutionStep[] | null>(\n    null\n  );\n\n  const bg = useColorModeValue(\"teal.100\", \"teal.800\");\n  return (\n    <VStack bg={bg} m={5} p={2} borderRadius=\"md\" align=\"start\">\n      <Heading size=\"lg\">Summary</Heading>\n      {/* <Code as=\"pre\">{JSON.stringify(steps, null, 2)}</Code> */}\n      <Button\n        onClick={() =>\n          estimate({ steps, terraContext, ethereumContext }, setExecutionSteps)\n        }\n      >\n        Estimate Transaction\n      </Button>\n      {executionSteps && (\n        <Box>\n          <Accordion allowToggle>\n            <AccordionItem>\n              <AccordionButton>\n                <Box flex=\"1\" textAlign=\"left\">\n                  Show Debug Info\n                </Box>\n              </AccordionButton>\n              <AccordionPanel>\n                <Code w=\"500px\" as=\"pre\" fontSize=\"8\">\n                  {JSON.stringify(executionSteps, null, 2)}\n                </Code>\n              </AccordionPanel>\n            </AccordionItem>\n          </Accordion>\n          <Button\n            onClick={() =>\n              execute({\n                executionSteps,\n                steps,\n                terraContext,\n                ethereumContext,\n                onStatusesChange,\n              })\n            }\n          >\n            Execute\n          </Button>\n        </Box>\n      )}\n    </VStack>\n  );\n}\n\ntype estimateArg = {\n  steps: Currency[];\n  terraContext: TerraContextProps;\n  ethereumContext: EthereumContextProps;\n};\n\ntype ExecutionStep =\n  | {\n      network: \"eth\";\n      args: EthereumRunArg;\n      info: {};\n    }\n  | {\n      network: \"terra\";\n      args: TerraRunArg;\n      info: {};\n    };\n\nasync function estimate(\n  { steps, terraContext, ethereumContext }: estimateArg,\n  setExecutionSteps: (steps: ExecutionStep[]) => void\n) {\n  // Do a bunch of things and then update the estimates and create intermediate transactions.\n  const executionSteps: ExecutionStep[] = [];\n  for (let i = 1; i < steps.length; i++) {\n    executionSteps.push(\n      await estimateStep(steps[i - 1], steps[i], {\n        terraContext,\n        ethereumContext,\n      })\n    );\n  }\n  setExecutionSteps(executionSteps);\n}\n\nasync function estimateStep(\n  input: Currency,\n  output: Currency,\n  { terraContext, ethereumContext }: WalletContexts\n): Promise<ExecutionStep> {\n  if (input.network === \"terra\" && output.network === \"ethereum\") {\n    // To Shuttle\n    if (!input.amount) {\n      throw new Error(\"No input amount\");\n    }\n    const estTx = await TerraToEth(input.amount, {\n      terraContext,\n      ethereumContext,\n    });\n    return {\n      network: \"terra\",\n      args: estTx,\n      info: estTx,\n    };\n  } else if (input.network === \"ethereum\" && output.network === \"terra\") {\n    if (!input.amount) {\n      throw new Error(\"No input amount\");\n    }\n    // To Shuttle\n    const estTx = await EthToTerra(input.amount, {\n      terraContext,\n      ethereumContext,\n    });\n    return {\n      network: \"eth\",\n      args: estTx,\n      info: estTx,\n    };\n  } else if (input.network === \"ethereum\" && output.network === \"ethereum\") {\n    if (!input.amount) {\n      throw new Error(\"No input amount\");\n    }\n    const { currency: inputCurrency } = input;\n    const { currency: outputCurrency } = output;\n    if (!inputCurrency || !outputCurrency) {\n      throw new Error(\"No specified input/output currencies\");\n    }\n\n    // 1inch route\n    const ret = await OneInchEstimate(\n      {\n        amountString: input.amount,\n        inputCurrency,\n        outputCurrency,\n      },\n      { ethereumContext }\n    );\n    return {\n      network: \"eth\",\n      args: ret.args,\n      info: ret.info,\n    };\n  }\n\n  throw new Error(\n    `Unimplemented operation ${JSON.stringify(input)} to ${JSON.stringify(\n      output\n    )}`\n  );\n}\n\ntype executeArg = {\n  executionSteps: ExecutionStep[];\n  steps: Currency[];\n  terraContext: TerraContextProps;\n  ethereumContext: EthereumContextProps;\n  onStatusesChange: (statuses: Status[]) => void;\n};\n\nasync function execute({\n  executionSteps,\n  steps,\n  terraContext,\n  ethereumContext,\n  onStatusesChange,\n}: executeArg) {\n  const statuses: Status[] = [];\n  for (let i = 0; i < executionSteps.length; i++) {\n    const step = executionSteps[i];\n    const currStep = i;\n    const onProgress = (status: Status) => {\n      statuses[currStep] = status;\n      onStatusesChange(statuses);\n    };\n    onProgress(\"Initiating step...\");\n    switch (step.network) {\n      case \"terra\":\n        await TerraRun(step.args, { terraContext, onProgress });\n        terraContext.refreshBalance();\n        onProgress(\"Waiting for transaction on Eth side\");\n        await EthWaitForShuttle({ ethereumContext, terraContext });\n        ethereumContext.refreshBalance();\n        break;\n      case \"eth\":\n        if (steps[i + 1].network === \"terra\") {\n          onProgress(\"Preparing for transaction...\");\n          // Get a snapshot of the current balance. So that we can watch for balance changes\n          // if coins were bridged.\n          await terraContext.refreshBalance();\n        }\n        await EthereumRun(step.args, { ethereumContext, onProgress });\n        // TODO: This doesn't get the new balance immediately :|\n        // Try another method to poll, possibly another UX pattern.\n        ethereumContext.refreshBalance();\n        if (steps[i + 1].network === \"terra\") {\n          // This is naive and just watches for any changes in the balance.\n          // This doesn't watch for changes in CW20 coins, only native coins.\n          onProgress(\"Waiting for transaction on Terra side\");\n          await WaitForBalanceChange({ terraContext, ethereumContext });\n        }\n        break;\n    }\n    onProgress(null);\n  }\n}\n","import React from \"react\";\nimport { Box, Button, HStack, Heading, useColorMode } from \"@chakra-ui/react\";\nimport { WalletConnector } from \"./WalletConnector\";\nimport { AllSteps } from \"./ConversionStep\";\n\nfunction App() {\n  const { colorMode, toggleColorMode } = useColorMode();\n  return (\n    <div className=\"App\">\n      <HStack pt={2} px={5} justify=\"space-between\">\n        <Heading>Modular Ramp</Heading>\n        <Box textAlign=\"right\">\n          <Button onClick={toggleColorMode}>\n            Toggle {colorMode === \"light\" ? \"Dark\" : \"Light\"}\n          </Button>\n        </Box>\n      </HStack>\n      <WalletConnector>\n        <AllSteps />\n      </WalletConnector>\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { ChakraProvider, ColorModeScript } from \"@chakra-ui/react\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <ColorModeScript initialColorMode={\"system\"} />\n    <ChakraProvider>\n      <App />\n    </ChakraProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}